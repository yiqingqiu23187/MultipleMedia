# PJ2说明文档

By 黄子豪 18302010034

## 一、获取图片的 RGB值

核心代码：

```matlab
for m = max(px - 1, 1) : min(px + 1, x) % 获取（x，y）及周围8个点坐标，通过max、min函数检查边界
    for n = max(py - 1, 1) : min(py + 1, y)
        fprintf('(%d, %d): (%d, %d, %d)\n', m, n, I(m, n, 1), I(m, n, 2), I(m, n, 3));
    end
end
```

边界检查是通过max和min完成的，m和n遍历的范围受到限制，不会小于1也不会超过高度或者宽度

测试结果：

![image-20201119201705099](C:\Users\LENOVO\AppData\Roaming\Typora\typora-user-images\image-20201119201705099.png)

## 二、实现rgb2gray函数

核心代码：

```matlab
grayI = 0.29900 * I(:, :, 1) + 0.58700 * I(:, :, 2) + 0.11400 * I(:, :, 3); % 文档上的公式，进行三维空间到一维空间的映射
v = var(grayI(:));                  % 计算灰度图片的方差
imwrite(grayI, "gray_" + imname);   % 将灰度图片保存在gray_imname
```

使用给出的公式计算灰度：$Gray = 0.29900 * R + 0.58700 * G + 0.11400 * B$

对于图像I的所有点都这么转换，得到的图片保存为“gray_”+原图像名

使用给出的图片satomi.jpg测试，效果如下：

![image-20201119202256628](C:\Users\LENOVO\AppData\Roaming\Typora\typora-user-images\image-20201119202256628.png)

## 三、灰度图对比度增强

思路：通过imadjust实现灰度区间[0.2, 0.6]到[0, 1]的拉伸（两端的点直接被对应地映射到0或者1），通过histeq实现直方图均衡化，最后用imhist分别得到二者的灰度分布直方图进行对比。

核心代码：

```matlab
J = imadjust(I, [0.2, 0.6], [0, 1]);% 灰度拉伸，把0.2-0.6的均匀拉伸到0-1，而小于0.2的直接设为0，大于0.6的直接设为1
H = histeq(I);                      % 直方图均衡化
```

使用gray_satomi.jpg实现效果：

![image-20201119202902863](C:\Users\LENOVO\AppData\Roaming\Typora\typora-user-images\image-20201119202902863.png)



**对灰度拉伸和直方图均衡化的理解：**

灰度拉伸只是简单的线性拉伸灰度，即只改变了图片的对比度，并不会破坏原有像素的排序，因此与原图对比虽然有提高，但是不如直方图均衡化。

直方图均衡化对灰度图进行非线性的拉伸，重新分配图像像素值，使得灰度值可以更均匀的分布在更多的灰度级上，顾名思义，“直方图均衡化“通过这样的操作使得灰度分布直方图更加均匀，提高了局部对比度，因此效果更好。

## 四、图像去噪

核心代码：

```matlab
I = imread('satomi.jpg');                % 读取文件
J2 = imnoise(I, 'salt & pepper', 0.04); % 叠加密度为0.04的椒盐噪声。
filter1 = medfilt3(J2,[3 3 1]);          % 中值,窗口大小为3×3
h = fspecial('average');         % 均值,窗口大小为3×3
filter2 = imfilter(J2, h);
```

首先使用imnoise给原图叠加0.04的椒盐噪声

使用中值去噪：

使用窗口大小为3x3的点的中位数作为中心点的值，即中值去噪；

使用均值去噪：

使用窗口大小为3x3的点的平均数作为中心点的值，即均值去噪。

以"satomi.jpg"为例，测试效果：

![image-20201119205000523](C:\Users\LENOVO\AppData\Roaming\Typora\typora-user-images\image-20201119205000523.png)



**造成差异的原因：**

中值滤波：由于是采用周围窗口大小数量的点的中值来代替中心像素灰度值，因此中值滤波相对而言只关心这些点像素值的相对大小，对于极限像素值，即与周围像素差别很大的像素点（通常是被叠加了噪声的像素点），并不敏感。因此拟合效果较好，能够尽可能消除噪声的影响（除非两个噪声点相隔过近）。

均值滤波：与中值滤波的差别是使用均值而非中值，因此滤波时会受到噪声点的影响，从而给图像带来一定程度的模糊，效果不如中值滤波好。

